# TOS TAKO Event Syscalls Conformance Specifications
# Based on: daemon/src/tako_integration/executor.rs (lines 767-769)
#
# Events emitted via log0-log4 syscalls (Ethereum-compatible)
# Captured via invoke_context.enable_event_collection()
# Events stored in ExecutionResult.events vector

---
spec:
  name: syscall_log0_basic
  version: "1.0"
  category: syscalls
  subcategory: events
  description: "Emit event with 0 indexed topics"
  priority: P0

preconditions:
  - contract_executing: true

action:
  type: syscall
  name: log0
  params:
    data: "0x48656c6c6f20576f726c64"  # "Hello World" in hex

expected:
  status: success
  event:
    topics: []  # No indexed topics
    data: "0x48656c6c6f20576f726c64"
  compute_units: 375  # ~375 CU

---
spec:
  name: syscall_log1_basic
  version: "1.0"
  category: syscalls
  subcategory: events
  description: "Emit event with 1 indexed topic"
  priority: P0

preconditions:
  - contract_executing: true

action:
  type: syscall
  name: log1
  params:
    topic0: "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"  # Transfer event signature
    data: "0x0000000000000000000000000000000000000000000000000000000000000064"  # amount = 100

expected:
  status: success
  event:
    topics:
      - "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"
    data: "0x0000000000000000000000000000000000000000000000000000000000000064"
  compute_units: 500  # ~500 CU

---
spec:
  name: syscall_log2_basic
  version: "1.0"
  category: syscalls
  subcategory: events
  description: "Emit event with 2 indexed topics"
  priority: P0

preconditions:
  - contract_executing: true

action:
  type: syscall
  name: log2
  params:
    topic0: "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"  # Approval event
    topic1: "0x000000000000000000000000alice_public_key_32_bytes_here__"  # owner
    data: "0x0000000000000000000000000000000000000000000000000000000000000064"

expected:
  status: success
  event:
    topics:
      - "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"
      - "0x000000000000000000000000alice_public_key_32_bytes_here__"
    data: "0x0000000000000000000000000000000000000000000000000000000000000064"
  compute_units: 625  # ~625 CU

---
spec:
  name: syscall_log3_transfer_event
  version: "1.0"
  category: syscalls
  subcategory: events
  description: "Standard ERC-20 Transfer event format"
  priority: P0

preconditions:
  - contract_executing: true

action:
  type: syscall
  name: log3
  params:
    topic0: "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"  # Transfer
    topic1: "0x000000000000000000000000from_address_32_bytes_padded___"  # from
    topic2: "0x000000000000000000000000to_address_32_bytes_padded_____"  # to
    data: "0x0000000000000000000000000000000000000000000000000000000000000064"  # amount

expected:
  status: success
  event:
    topics:
      - "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"
      - "0x000000000000000000000000from_address_32_bytes_padded___"
      - "0x000000000000000000000000to_address_32_bytes_padded_____"
    data: "0x0000000000000000000000000000000000000000000000000000000000000064"
  compute_units: 750  # ~750 CU

---
spec:
  name: syscall_log4_maximum_topics
  version: "1.0"
  category: syscalls
  subcategory: events
  description: "Maximum 4 indexed topics"
  priority: P0

preconditions:
  - contract_executing: true

action:
  type: syscall
  name: log4
  params:
    topic0: "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
    topic1: "0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef12345678"
    topic2: "0x1111111111111111111111111111111111111111111111111111111111111111"
    topic3: "0x2222222222222222222222222222222222222222222222222222222222222222"
    data: "0xdeadbeef"

expected:
  status: success
  event:
    topics:
      - "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
      - "0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef12345678"
      - "0x1111111111111111111111111111111111111111111111111111111111111111"
      - "0x2222222222222222222222222222222222222222222222222222222222222222"
    data: "0xdeadbeef"
  compute_units: 875  # ~875 CU

---
spec:
  name: syscall_log_empty_data
  version: "1.0"
  category: syscalls
  subcategory: events
  description: "Event with empty data payload"
  priority: P1

preconditions:
  - contract_executing: true

action:
  type: syscall
  name: log1
  params:
    topic0: "0xabcdef..."
    data: ""  # Empty data

expected:
  status: success
  event:
    topics: ["0xabcdef..."]
    data: ""

---
spec:
  name: syscall_log_large_data
  version: "1.0"
  category: syscalls
  subcategory: events
  description: "Event with large data payload"
  priority: P1

preconditions:
  - contract_executing: true

action:
  type: syscall
  name: log0
  params:
    data: "0x..."  # 1024 bytes of data

expected:
  status: success
  compute_units: ">= 375"  # Base cost + memory cost

---
spec:
  name: syscall_log_multiple_events
  version: "1.0"
  category: syscalls
  subcategory: events
  description: "Multiple events in single execution"
  priority: P1

preconditions:
  - contract_executing: true

action:
  type: syscall_sequence
  calls:
    - name: log1
      params: { topic0: "0xevent1...", data: "0x01" }
    - name: log1
      params: { topic0: "0xevent2...", data: "0x02" }
    - name: log1
      params: { topic0: "0xevent3...", data: "0x03" }

expected:
  - status: success
  - status: success
  - status: success
  total_events: 3

---
spec:
  name: syscall_log_event_collection
  version: "1.0"
  category: syscalls
  subcategory: events
  description: "Events collected in ExecutionResult.events"
  priority: P0

preconditions:
  - event_collection_enabled: true

action:
  type: execute_contract
  contract_calls_log1: true

expected:
  status: success
  execution_result:
    events:
      - contract: "contract_hash"
        topics: ["0x..."]
        data: "0x..."
