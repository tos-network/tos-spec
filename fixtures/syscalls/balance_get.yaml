# TOS TAKO Balance Query Syscalls Conformance Specifications
# Based on: daemon/src/tako_integration/accounts.rs
#
# TAKO uses get_balance syscall for account balance queries
# Addresses are 32-byte PublicKeys (NOT 20-byte EVM addresses)
# Default asset: Hash::zero() (native TOS token)

---
spec:
  name: syscall_get_balance_existing
  version: "1.0"
  category: syscalls
  subcategory: balance
  description: "Query balance of existing account"
  priority: P0

preconditions:
  - account:
      address: "tos1alice..." # 32-byte PublicKey
      balance: 100000000  # 1 TOS (10^8 atomic units)

action:
  type: syscall
  name: get_balance
  params:
    address: "tos1alice..."  # &[u8; 32]

expected:
  status: success
  result: 100000000
  result_type: u64
  compute_units: 500  # ~500 CU

---
spec:
  name: syscall_get_balance_nonexistent
  version: "1.0"
  category: syscalls
  subcategory: balance
  description: "Query balance of non-existent account returns 0"
  priority: P0

preconditions:
  - account_not_exists: "tos1unknown..."

action:
  type: syscall
  name: get_balance
  params:
    address: "tos1unknown..."

expected:
  status: success
  result: 0  # Non-existent accounts have zero balance
  compute_units: 500

---
spec:
  name: syscall_get_balance_with_asset
  version: "1.0"
  category: syscalls
  subcategory: balance
  description: "Query balance for specific asset"
  priority: P1

preconditions:
  - account:
      address: "tos1alice..."
      balances:
        native: 100000000  # Hash::zero() = native TOS
        token_abc: 50000000  # Custom token

action:
  type: syscall
  name: get_balance
  params:
    address: "tos1alice..."
    asset: "token_abc_hash"  # Hash of asset

expected:
  status: success
  result: 50000000
  compute_units: 500

---
spec:
  name: syscall_get_balance_virtual_calculation
  version: "1.0"
  category: syscalls
  subcategory: balance
  description: "Balance includes pending deltas (virtual balance)"
  priority: P1

preconditions:
  - account:
      address: "tos1alice..."
      actual_balance: 100000000
  - pending_delta: -20000000  # Pending transfer out

action:
  type: syscall
  name: get_balance
  params:
    address: "tos1alice..."

expected:
  status: success
  result: 80000000  # actual_balance + pending_delta
  note: "Virtual balance prevents double-spend in same block"

---
spec:
  name: syscall_get_balance_readonly
  version: "1.0"
  category: syscalls
  subcategory: balance
  description: "Balance query does not modify state"
  priority: P0

preconditions:
  - account:
      address: "tos1alice..."
      balance: 100000000

action:
  type: syscall
  name: get_balance
  params:
    address: "tos1alice..."

expected:
  status: success
  result: 100000000

postconditions:
  - account:
      address: "tos1alice..."
      balance: 100000000  # Unchanged
