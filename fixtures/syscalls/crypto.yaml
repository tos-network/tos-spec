# TOS TAKO Cryptographic Syscalls Conformance Specifications
# Based on: daemon/src/tako_integration/precompile_cost.rs, precompile_verifier.rs
#           tck/contracts/crypto_advanced/src/lib.rs
#
# TAKO provides native crypto syscalls and signature verification precompiles
# Costs are hardware-calibrated based on actual benchmarks

---
spec:
  name: syscall_blake3_hash
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "BLAKE3 hash (32 bytes output, TOS native)"
  priority: P0

preconditions:
  - input_data: "0x48656c6c6f"  # "Hello"

action:
  type: syscall
  name: blake3
  params:
    data: "input_data"

expected:
  status: success
  result_size: 32  # bytes
  note: "BLAKE3 is TOS native hash for txid and block hash"

---
spec:
  name: syscall_keccak256_hash
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "Keccak-256 hash (EVM compatible)"
  priority: P0

preconditions:
  - input_data: "0x48656c6c6f"

action:
  type: syscall
  name: keccak256
  params:
    data_ptr: "input_data"
    data_len: 5
    out_ptr: "output_buffer"

expected:
  status: success
  result_size: 32  # bytes
  note: "EVM-compatible Keccak-256 for contract function selectors"

---
spec:
  name: syscall_sha256_hash
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "SHA-256 hash (Bitcoin compatible)"
  priority: P1

preconditions:
  - input_data: "0x48656c6c6f"

action:
  type: syscall
  name: sha256
  params:
    data_ptr: "input_data"
    data_len: 5
    out_ptr: "output_buffer"

expected:
  status: success
  result_size: 32  # bytes
  note: "SHA-256 for Bitcoin compatibility"

---
spec:
  name: syscall_ripemd160_hash
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "RIPEMD-160 hash (20 bytes, EVM precompile 0x03)"
  priority: P1

preconditions:
  - input_data: "0x48656c6c6f"
  - input_size: 5

action:
  type: syscall
  name: ripemd160
  params:
    data_ptr: "input_data"
    data_len: 5
    out_ptr: "output_buffer"

expected:
  status: success
  result_size: 20  # bytes
  compute_units: 720  # BASE 600 + 120 * ceil(5/32)
  note: "Cost: 600 CU base + 120 CU per 32-byte word"

---
spec:
  name: syscall_modexp_basic
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "Modular exponentiation (base^exp % modulus)"
  priority: P1

preconditions:
  - base: 2
  - exponent: 10
  - modulus: 1000

action:
  type: syscall
  name: modexp
  params:
    input_ptr: "encoded_input"
    input_len: 128
    out_ptr: "output_buffer"
    out_cap: 32

expected:
  status: success
  result: 24  # 2^10 mod 1000 = 1024 mod 1000 = 24
  note: "EVM precompile 0x05 compatible"

---
spec:
  name: syscall_poseidon_hash
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "Poseidon hash (ZK-friendly, SVM compatible)"
  priority: P1

preconditions:
  - input_values: [1, 2, 3]

action:
  type: syscall
  name: poseidon
  params:
    parameters: 0
    endianness: 0  # big-endian
    vals_addr: "input_values"
    vals_len: 3
    result_addr: "output_buffer"

expected:
  status: success
  result_size: 32  # bytes
  note: "ZK-SNARK/STARK friendly hash function"

---
spec:
  name: syscall_bn254_g1_compress
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "BN254 G1 point compression"
  priority: P2

preconditions:
  - uncompressed_point: "64_bytes_uncompressed_g1_point"

action:
  type: syscall
  name: bn254_g1_compress
  params:
    uncompressed_ptr: "uncompressed_point"
    uncompressed_len: 64
    compressed_ptr: "output_buffer"
    little_endian: 0

expected:
  status: success
  result_size: 33  # compressed point
  note: "Used for zkSNARK proof optimization"

---
spec:
  name: syscall_bn254_g1_decompress
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "BN254 G1 point decompression"
  priority: P2

preconditions:
  - compressed_point: "33_bytes_compressed_g1_point"

action:
  type: syscall
  name: bn254_g1_decompress
  params:
    compressed_ptr: "compressed_point"
    compressed_len: 33
    uncompressed_ptr: "output_buffer"
    little_endian: 0

expected:
  status: success
  result_size: 64  # uncompressed point
  note: "Used for zkSNARK proof verification"

---
spec:
  name: precompile_ed25519_verify
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "Ed25519 signature verification precompile"
  priority: P0

preconditions:
  - program_id: "[3, 0, 0, 0, ...]"
  - signature: "64_bytes_ed25519_signature"
  - public_key: "32_bytes_ed25519_pubkey"
  - message: "arbitrary_message"

action:
  type: precompile
  program_id: "ed25519"
  params:
    num_signatures: 1
    signatures: ["signature"]
    public_keys: ["public_key"]
    messages: ["message"]

expected:
  status: success
  compute_units: 2280  # per signature, SVM-aligned
  note: "Ed25519 signature verification"

---
spec:
  name: precompile_secp256k1_verify
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "secp256k1 signature verification precompile"
  priority: P0

preconditions:
  - program_id: "[2, 0, 0, 0, ...]"
  - signature: "65_bytes_secp256k1_signature"  # r(32) + s(32) + v(1)
  - public_key: "33_or_65_bytes_pubkey"
  - message_hash: "32_bytes_hash"

action:
  type: precompile
  program_id: "secp256k1"
  params:
    num_signatures: 1
    signatures: ["signature"]
    public_keys: ["public_key"]
    message_hashes: ["message_hash"]

expected:
  status: success
  compute_units: 6690  # per signature
  note: "secp256k1 compatible"

---
spec:
  name: precompile_secp256r1_verify
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "secp256r1 (P-256) signature verification precompile"
  priority: P1

preconditions:
  - program_id: "[113, 0, 0, 0, ...]"
  - signature: "64_bytes_secp256r1_signature"
  - public_key: "64_bytes_uncompressed_pubkey"
  - message_hash: "32_bytes_hash"

action:
  type: precompile
  program_id: "secp256r1"
  params:
    num_signatures: 1
    signatures: ["signature"]
    public_keys: ["public_key"]
    message_hashes: ["message_hash"]

expected:
  status: success
  compute_units: 4800  # per signature
  note: "NIST P-256 curve, WebAuthn compatible"

---
spec:
  name: precompile_schnorr_ristretto_verify
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "Schnorr Ristretto signature verification (TOS native)"
  priority: P0

preconditions:
  - program_id: "[4, 0, 0, 0, ...]"
  - signature: "64_bytes_schnorr_signature"  # s(32) + e(32)
  - public_key: "32_bytes_ristretto_point"
  - message: "arbitrary_message"

action:
  type: precompile
  program_id: "schnorr_ristretto"
  params:
    num_signatures: 1
    signatures: ["signature"]
    public_keys: ["public_key"]
    messages: ["message"]

expected:
  status: success
  compute_units: 69000  # hardware calibrated (68.509 Âµs median)
  note: "TOS native signature scheme using Ristretto255"

---
spec:
  name: precompile_threshold_multisig_verify
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "Threshold multisig verification (t-of-n)"
  priority: P1

preconditions:
  - program_id: "[5, 0, 0, 0, ...]"
  - threshold: 2
  - signatures: ["sig1", "sig2"]  # t signatures
  - public_keys: ["pk1", "pk2", "pk3"]  # n public keys

action:
  type: precompile
  program_id: "threshold_multisig"
  params:
    threshold: 2
    total_signers: 3
    signatures: ["sig1", "sig2"]
    public_keys: ["pk1", "pk2", "pk3"]
    message: "message"

expected:
  status: success
  compute_units: 192000  # BASE(20000) + threshold(2) * 86000
  note: "Cost: 20,000 CU base + 86,000 CU per signature"

---
spec:
  name: precompile_bls_fast_aggregate_verify
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "BLS fast aggregate signature verification"
  priority: P2

preconditions:
  - program_id: "[6, 0, 0, 0, ...]"
  - aggregate_signature: "96_bytes_bls_signature"
  - public_keys: ["pk1", "pk2", "...", "pk10"]  # 10 signers
  - message: "shared_message"

action:
  type: precompile
  program_id: "bls_fast_aggregate"
  params:
    num_signers: 10
    aggregate_signature: "aggregate_signature"
    public_keys: ["pk1", "...", "pk10"]
    message: "message"

expected:
  status: success
  compute_units: 1543000  # BASE(843000) + num_signers(10) * 70000
  note: "Cost: 843,000 CU base + 70,000 CU per signer"

---
spec:
  name: syscall_signature_invalid
  version: "1.0"
  category: syscalls
  subcategory: crypto
  description: "Invalid signature returns error"
  priority: P0

preconditions:
  - signature: "invalid_signature_bytes"
  - public_key: "valid_public_key"
  - message: "message"

action:
  type: precompile
  program_id: "schnorr_ristretto"
  params:
    signatures: ["invalid_signature_bytes"]
    public_keys: ["public_key"]
    messages: ["message"]

expected:
  status: error
  error: "SignatureVerificationFailed"
  note: "Invalid signatures are rejected at precompile level"
