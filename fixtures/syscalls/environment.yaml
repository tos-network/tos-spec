# TOS TAKO Environment Syscalls Conformance Specifications
# Based on: daemon/src/tako_integration/executor.rs (lines 635-726)
#
# Environment data injected into InvokeContext during executor setup
# All fields are 32-byte hashes or u64 values
# Immutable during execution (read-only context)

---
spec:
  name: syscall_get_caller
  version: "1.0"
  category: syscalls
  subcategory: environment
  description: "Get transaction sender (caller) address"
  priority: P0

preconditions:
  - tx_sender: "tos1alice..."

action:
  type: syscall
  name: get_caller
  params: []

expected:
  status: success
  result: "tos1alice..."  # [u8; 32]
  compute_units: 100  # ~100 CU

---
spec:
  name: syscall_get_signer
  version: "1.0"
  category: syscalls
  subcategory: environment
  description: "Get transaction signer (same as caller for direct calls)"
  priority: P1

preconditions:
  - tx_signer: "tos1alice..."

action:
  type: syscall
  name: get_signer
  params: []

expected:
  status: success
  result: "tos1alice..."  # [u8; 32]
  compute_units: 100

---
spec:
  name: syscall_get_program_id
  version: "1.0"
  category: syscalls
  subcategory: environment
  description: "Get current contract address"
  priority: P0

preconditions:
  - contract_address: "contract_hash_abc..."

action:
  type: syscall
  name: get_program_id
  params: []

expected:
  status: success
  result: "contract_hash_abc..."  # [u8; 32]
  compute_units: 100

---
spec:
  name: syscall_get_block_hash
  version: "1.0"
  category: syscalls
  subcategory: environment
  description: "Get current block hash"
  priority: P0

preconditions:
  - block_hash: "block_hash_123..."

action:
  type: syscall
  name: get_block_hash
  params: []

expected:
  status: success
  result: "block_hash_123..."  # [u8; 32] - BLAKE3 hash
  compute_units: 100

---
spec:
  name: syscall_get_block_height
  version: "1.0"
  category: syscalls
  subcategory: environment
  description: "Get current block height"
  priority: P0

preconditions:
  - block_height: 12345

action:
  type: syscall
  name: get_block_height
  params: []

expected:
  status: success
  result: 12345  # u64
  compute_units: 100

---
spec:
  name: syscall_get_block_timestamp
  version: "1.0"
  category: syscalls
  subcategory: environment
  description: "Get block timestamp (Unix milliseconds)"
  priority: P0

preconditions:
  - block_timestamp: 1700000000000  # Milliseconds since epoch

action:
  type: syscall
  name: get_block_timestamp
  params: []

expected:
  status: success
  result: 1700000000000  # u64 (milliseconds)
  compute_units: 100

---
spec:
  name: syscall_get_tx_hash
  version: "1.0"
  category: syscalls
  subcategory: environment
  description: "Get transaction hash"
  priority: P0

preconditions:
  - tx_hash: "tx_hash_abc..."

action:
  type: syscall
  name: get_tx_hash
  params: []

expected:
  status: success
  result: "tx_hash_abc..."  # [u8; 32] - BLAKE3 hash
  compute_units: 100

---
spec:
  name: syscall_get_input_data
  version: "1.0"
  category: syscalls
  subcategory: environment
  description: "Get contract input parameters"
  priority: P0

preconditions:
  - contract_input: "0xabcdef123456..."

action:
  type: syscall
  name: get_input_data
  params: []

expected:
  status: success
  result: "0xabcdef123456..."  # Vec<u8>
  compute_units: 100

---
spec:
  name: syscall_get_topoheight
  version: "1.0"
  category: syscalls
  subcategory: environment
  description: "Get topological height (TOS-specific)"
  priority: P1

preconditions:
  - topoheight: 15000

action:
  type: syscall
  name: get_topoheight
  params: []

expected:
  status: success
  result: 15000  # u64
  compute_units: 100

---
spec:
  name: syscall_get_instant_random
  version: "1.0"
  category: syscalls
  subcategory: environment
  description: "Get deterministic random from block state"
  priority: P1

preconditions:
  - block_hash: "block_hash_..."
  - block_height: 12345
  - block_timestamp: 1700000000000
  - tx_hash: "tx_hash_..."

action:
  type: syscall
  name: get_instant_random
  params: []

expected:
  status: success
  result_type: u64
  deterministic: true  # BLAKE3(block_hash || height || timestamp || tx_hash)
  compute_units: 100

---
spec:
  name: syscall_vrf_random
  version: "1.0"
  category: syscalls
  subcategory: environment
  description: "Get VRF random (cryptographically verifiable)"
  priority: P2

preconditions:
  - vrf_enabled: true
  - miner_public_key: "miner_pubkey_..."

action:
  type: syscall
  name: vrf_random
  params: []

expected:
  status: success
  result:
    output: "[u8; 32]"  # VRF output
    proof: "[u8; 32]"   # VRF proof
    random: "u64"       # Derived random value
  compute_units: 500

---
spec:
  name: syscall_environment_immutable
  version: "1.0"
  category: syscalls
  subcategory: environment
  description: "Environment values are immutable during execution"
  priority: P0

preconditions:
  - block_height: 12345

action:
  type: syscall_sequence
  calls:
    - name: get_block_height
    - name: get_block_height  # Second call

expected:
  - status: success
    result: 12345
  - status: success
    result: 12345  # Same value - immutable
