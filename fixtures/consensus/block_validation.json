{
  "cases": [
    {
      "name": "consensus_block_valid_dag",
      "description": "Valid block with DAG tips is accepted",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": []
      },
      "tx": null,
      "expected": {
        "ok": true,
        "error": null,
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_block_invalid_no_tips",
      "description": "Block with no tips (except genesis) is rejected",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": []
      },
      "tx": null,
      "expected": {
        "ok": false,
        "error": "EXPECTED_TIPS",
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_block_invalid_tips_count",
      "description": "Block with more than TIPS_LIMIT tips is rejected",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": []
      },
      "tx": null,
      "expected": {
        "ok": false,
        "error": "INVALID_TIPS_COUNT",
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_block_invalid_tip_not_found",
      "description": "Block with unknown tip is rejected",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": []
      },
      "tx": null,
      "expected": {
        "ok": false,
        "error": "INVALID_TIPS_NOT_FOUND",
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_block_invalid_height",
      "description": "Block with height not matching tips is rejected",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": []
      },
      "tx": null,
      "expected": {
        "ok": false,
        "error": "INVALID_BLOCK_HEIGHT",
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_block_invalid_height_stable",
      "description": "Block with height in stable range is rejected",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": []
      },
      "tx": null,
      "expected": {
        "ok": false,
        "error": "INVALID_BLOCK_HEIGHT_STABLE_HEIGHT",
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_block_invalid_timestamp_future",
      "description": "Block with timestamp >2 seconds in future is rejected",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": []
      },
      "tx": null,
      "expected": {
        "ok": false,
        "error": "TIMESTAMP_IS_IN_FUTURE",
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_block_invalid_timestamp_past",
      "description": "Block with timestamp less than parent is rejected",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": []
      },
      "tx": null,
      "expected": {
        "ok": false,
        "error": "TIMESTAMP_IS_LESS_THAN_PARENT",
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_block_invalid_difficulty",
      "description": "Block with invalid proof-of-work difficulty is rejected",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": []
      },
      "tx": null,
      "expected": {
        "ok": false,
        "error": "INVALID_DIFFICULTY",
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_block_invalid_tips_difficulty",
      "description": "Block must reference tips with highest cumulative difficulty",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": []
      },
      "tx": null,
      "expected": {
        "ok": false,
        "error": "INVALID_TIPS_DIFFICULTY",
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_block_size_limit",
      "description": "Block exceeding MAX_BLOCK_SIZE is rejected",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": []
      },
      "tx": null,
      "expected": {
        "ok": false,
        "error": "INVALID_BLOCK_SIZE",
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_nonce_sequential",
      "description": "Transactions in block must have sequential nonces per sender",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": [
          {
            "address": "8ac58b65bd79308ec52981a92cbb8d021a51369f96918ffbd8efc3dd2819f369",
            "balance": 0,
            "nonce": 0,
            "frozen": 0,
            "energy": 0,
            "flags": 0,
            "data": ""
          }
        ]
      },
      "tx": null,
      "expected": {
        "ok": true,
        "error": null,
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_nonce_gap_rejected",
      "description": "Transaction with nonce gap is orphaned",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": [
          {
            "address": "8ac58b65bd79308ec52981a92cbb8d021a51369f96918ffbd8efc3dd2819f369",
            "balance": 0,
            "nonce": 0,
            "frozen": 0,
            "energy": 0,
            "flags": 0,
            "data": ""
          }
        ]
      },
      "tx": null,
      "expected": {
        "ok": false,
        "error": "INVALID_TRANSACTION_NONCE",
        "post_state": null
      },
      "runnable": false
    },
    {
      "name": "consensus_block_version",
      "description": "Block version must be valid for current height",
      "pre_state": {
        "network_chain_id": 0,
        "global_state": {
          "total_supply": 0,
          "total_burned": 0,
          "total_energy": 0,
          "block_height": 0,
          "timestamp": 0
        },
        "accounts": []
      },
      "tx": null,
      "expected": {
        "ok": false,
        "error": "INVALID_BLOCK_VERSION",
        "post_state": null
      },
      "runnable": false
    }
  ]
}
