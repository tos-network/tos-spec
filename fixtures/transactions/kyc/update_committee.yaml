# TOS UpdateCommittee Transaction Conformance Specifications
# Based on: common/src/transaction/payload/kyc/update.rs
#
# Modify committee configuration (members, thresholds, status)

---
spec:
  name: tx_update_committee_add_member
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "Add new member to committee"
  priority: P0

preconditions:
  - committee:
      id: "0xcommittee..."
      status: "Active"
      threshold: 5
      members_count: 7
  - sender:
      address: "tos1sender..."
      balance: 100000000
      nonce: 0

action:
  type: transaction
  tx_type: UpdateCommittee
  params:
    committee_id: "0xcommittee..."
    update:
      type: AddMember
      public_key: "tos1new_member..."
      name: "New Member"
      role: "Verifier"
    approvals:
      - member_pubkey: "tos1member1..."
        signature: "<valid_signature>"
        timestamp: 1706832000
      - member_pubkey: "tos1member2..."
        signature: "<valid_signature>"
        timestamp: 1706832000
      - member_pubkey: "tos1member3..."
        signature: "<valid_signature>"
        timestamp: 1706832000
      - member_pubkey: "tos1member4..."
        signature: "<valid_signature>"
        timestamp: 1706832000
      - member_pubkey: "tos1member5..."
        signature: "<valid_signature>"
        timestamp: 1706832000
    fee: 40000
    nonce: 0

expected:
  status: success

postconditions:
  - committee:
      members_count: 8

---
spec:
  name: tx_update_committee_remove_member
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "Remove member from committee"
  priority: P0

action:
  type: transaction
  tx_type: UpdateCommittee
  params:
    committee_id: "0xcommittee..."
    update:
      type: RemoveMember
      public_key: "tos1member_to_remove..."
    approvals: [...]

expected:
  status: success

note: |
  Removing a member may require threshold adjustment
  if it would violate the 2/3 requirement.

---
spec:
  name: tx_update_committee_update_role
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "Update member role"
  priority: P1

action:
  type: transaction
  tx_type: UpdateCommittee
  params:
    committee_id: "0xcommittee..."
    update:
      type: UpdateMemberRole
      public_key: "tos1member..."
      new_role: "Admin"
    approvals: [...]

expected:
  status: success

---
spec:
  name: tx_update_committee_update_status
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "Update member status"
  priority: P1

definition:
  member_statuses:
    Active: 0
    Inactive: 1
    Suspended: 2

action:
  type: transaction
  tx_type: UpdateCommittee
  params:
    committee_id: "0xcommittee..."
    update:
      type: UpdateMemberStatus
      public_key: "tos1member..."
      new_status: "Suspended"
    approvals: [...]

expected:
  status: success

---
spec:
  name: tx_update_committee_update_threshold
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "Update governance threshold"
  priority: P0

preconditions:
  - committee:
      members_count: 9
      threshold: 6

action:
  type: transaction
  tx_type: UpdateCommittee
  params:
    committee_id: "0xcommittee..."
    update:
      type: UpdateThreshold
      new_threshold: 7
    approvals: [...]

expected:
  status: success

postconditions:
  - committee:
      threshold: 7

---
spec:
  name: tx_update_committee_threshold_too_low
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "New threshold must be >= 2/3 of members"
  priority: P0

preconditions:
  - committee:
      members_count: 9
      threshold: 6

action:
  type: transaction
  tx_type: UpdateCommittee
  params:
    committee_id: "0xcommittee..."
    update:
      type: UpdateThreshold
      new_threshold: 4  # < 2/3 of 9

expected:
  status: error
  error: "ThresholdTooLow"

---
spec:
  name: tx_update_committee_update_kyc_threshold
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "Update KYC approval threshold"
  priority: P1

action:
  type: transaction
  tx_type: UpdateCommittee
  params:
    committee_id: "0xcommittee..."
    update:
      type: UpdateKycThreshold
      new_kyc_threshold: 2
    approvals: [...]

expected:
  status: success

---
spec:
  name: tx_update_committee_update_name
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "Update committee name"
  priority: P2

action:
  type: transaction
  tx_type: UpdateCommittee
  params:
    committee_id: "0xcommittee..."
    update:
      type: UpdateName
      new_name: "US Regional Committee v2"
    approvals: [...]

expected:
  status: success

---
spec:
  name: tx_update_committee_suspend
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "Suspend committee"
  priority: P1

action:
  type: transaction
  tx_type: UpdateCommittee
  params:
    committee_id: "0xcommittee..."
    update:
      type: SuspendCommittee
    approvals: [...]

expected:
  status: success

postconditions:
  - committee:
      status: "Suspended"

note: |
  Suspended committees cannot:
  - Approve new KYC
  - Revoke KYC
  - Register child committees

---
spec:
  name: tx_update_committee_activate
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "Activate suspended committee"
  priority: P1

preconditions:
  - committee:
      status: "Suspended"

action:
  type: transaction
  tx_type: UpdateCommittee
  params:
    committee_id: "0xcommittee..."
    update:
      type: ActivateCommittee
    approvals: [...]

expected:
  status: success

postconditions:
  - committee:
      status: "Active"

---
spec:
  name: tx_update_committee_insufficient_approvals
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "Update requires threshold approvals"
  priority: P0

preconditions:
  - committee:
      threshold: 5

action:
  type: transaction
  tx_type: UpdateCommittee
  params:
    committee_id: "0xcommittee..."
    approvals:
      - member_pubkey: "tos1member1..."
      - member_pubkey: "tos1member2..."
      - member_pubkey: "tos1member3..."
      # Only 3 approvals, need 5

expected:
  status: error
  error: "InsufficientApprovals"

---
spec:
  name: tx_update_committee_not_found
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "Cannot update non-existent committee"
  priority: P0

action:
  type: transaction
  tx_type: UpdateCommittee
  params:
    committee_id: "0xnonexistent..."

expected:
  status: error
  error: "CommitteeNotFound"

---
spec:
  name: tx_update_committee_update_types
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "Committee update type enumeration"
  priority: P0

definition:
  update_types:
    AddMember: 0
    RemoveMember: 1
    UpdateMemberRole: 2
    UpdateMemberStatus: 3
    UpdateThreshold: 4
    UpdateKycThreshold: 5
    UpdateName: 6
    SuspendCommittee: 7
    ActivateCommittee: 8

---
spec:
  name: tx_update_committee_payload_structure
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "UpdateCommitteePayload wire format"
  priority: P0

definition:
  update_committee_payload:
    committee_id:
      type: Hash
      size: 32
    update:
      type: CommitteeUpdateData
      description: "Variant based on update type"
    approvals:
      type: "Vec<CommitteeApproval>"

  committee_update_data:
    variants:
      AddMember:
        fields: [public_key, name, role]
      RemoveMember:
        fields: [public_key]
      UpdateMemberRole:
        fields: [public_key, new_role]
      UpdateMemberStatus:
        fields: [public_key, new_status]
      UpdateThreshold:
        fields: [new_threshold]
      UpdateKycThreshold:
        fields: [new_kyc_threshold]
      UpdateName:
        fields: [new_name]
      SuspendCommittee:
        fields: []
      ActivateCommittee:
        fields: []

---
spec:
  name: tx_update_committee_gas_cost
  version: "1.0"
  category: transactions
  subcategory: kyc
  description: "UpdateCommittee gas consumption"
  priority: P1

definition:
  gas_cost: 40000
