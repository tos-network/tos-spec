# TOS TNS (TOS Name Service) Transaction Conformance Specifications
# Based on: common/src/transaction/payload/tns.rs
#
# Register human-readable names

---
spec:
  name: tx_register_name_basic
  version: "1.0"
  category: transactions
  subcategory: tns
  description: "Basic TNS name registration"
  priority: P0

preconditions:
  - sender:
      address: "tos1sender..."
      balance: 100000000  # 1 TOS
      nonce: 0
  - name:
      value: "alice"
      available: true

action:
  type: transaction
  tx_type: RegisterName
  params:
    name: "alice"
    fee: 10000
    nonce: 0

expected:
  status: success

postconditions:
  - sender:
      nonce: 1
  - name_record:
      name: "alice"
      owner: "tos1sender..."
      full_address: "alice@tos.network"

---
spec:
  name: tx_register_name_length_validation
  version: "1.0"
  category: transactions
  subcategory: tns
  description: "Name length constraints"
  priority: P0

definition:
  MIN_NAME_LENGTH: 3
  MAX_NAME_LENGTH: 64

tests:
  - name: too_short
    name: "ab"  # 2 chars
    expected: error
    error: "NameTooShort"

  - name: minimum_length
    name: "abc"  # 3 chars
    expected: valid

  - name: maximum_length
    name: "<64 character string>"
    expected: valid

  - name: too_long
    name: "<65 character string>"
    expected: error
    error: "NameTooLong"

---
spec:
  name: tx_register_name_character_validation
  version: "1.0"
  category: transactions
  subcategory: tns
  description: "Valid name characters"
  priority: P0

tests:
  - name: lowercase_letters
    name: "alice"
    expected: valid

  - name: numbers
    name: "alice123"
    expected: valid

  - name: underscore
    name: "alice_smith"
    expected: valid

  - name: hyphen
    name: "alice-smith"
    expected: valid

  - name: uppercase_normalized
    name: "ALICE"
    expected: valid
    note: "Normalized to 'alice' during verification"

  - name: invalid_special_chars
    name: "alice@bob"
    expected: error
    error: "InvalidNameCharacter"

  - name: spaces_not_allowed
    name: "alice smith"
    expected: error
    error: "InvalidNameCharacter"

---
spec:
  name: tx_register_name_already_taken
  version: "1.0"
  category: transactions
  subcategory: tns
  description: "Cannot register existing name"
  priority: P0

preconditions:
  - name:
      value: "alice"
      available: false
      owner: "tos1existing..."

action:
  type: transaction
  tx_type: RegisterName
  params:
    name: "alice"

expected:
  status: error
  error: "NameAlreadyRegistered"

---
spec:
  name: tx_register_name_already_has_name
  version: "1.0"
  category: transactions
  subcategory: tns
  description: "Account can only have one name"
  priority: P0

preconditions:
  - sender:
      tns_name: "bob"  # Already has a name

action:
  type: transaction
  tx_type: RegisterName
  params:
    name: "alice"

expected:
  status: error
  error: "AccountAlreadyHasName"

---
spec:
  name: tx_register_name_case_insensitive
  version: "1.0"
  category: transactions
  subcategory: tns
  description: "Names are case-insensitive"
  priority: P0

preconditions:
  - name:
      value: "alice"
      available: false

action:
  type: transaction
  tx_type: RegisterName
  params:
    name: "ALICE"  # Different case

expected:
  status: error
  error: "NameAlreadyRegistered"
  note: "Names are normalized to lowercase for uniqueness"

---
spec:
  name: tx_register_name_payload_structure
  version: "1.0"
  category: transactions
  subcategory: tns
  description: "RegisterNamePayload wire format"
  priority: P0

definition:
  register_name_payload:
    name:
      type: String
      encoding: UTF-8
      min_length: 3
      max_length: 64

serialization_order:
  - name_length (1 byte)
  - name_bytes (variable, max 64 bytes)

---
spec:
  name: tx_tns_gas_costs
  version: "1.0"
  category: transactions
  subcategory: tns
  description: "TNS transaction gas costs"
  priority: P1

definition:
  register_name_gas: 10000
