# TOS TAKO NFT Syscalls Conformance Specifications
# Based on: daemon/src/tako_integration/nft.rs, executor.rs
#           tck/tests/tako_nft_syscalls_test.rs
#
# TAKO provides 21 native NFT syscalls with 2000 CU base cost
# NFT collections are native TOS assets, not smart contracts

---
spec:
  name: syscall_nft_create_collection
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Create a new NFT collection"
  priority: P0

preconditions:
  - caller:
      address: "tos1creator..."
  - collection_not_exists: true

action:
  type: syscall
  name: nft_create_collection
  params:
    name: "My Collection"
    symbol: "MYCOL"
    metadata_uri: "ipfs://QmCollection..."
    max_supply: 10000
    mint_authority: "owner_only"
    royalty_bps: 500  # 5%

expected:
  status: success
  compute_units: 2000
  result:
    collection_id: "Hash"
    owner: "tos1creator..."

---
spec:
  name: syscall_nft_collection_exists
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Check if NFT collection exists"
  priority: P0

preconditions:
  - collection:
      id: "collection_hash"
      exists: true

action:
  type: syscall
  name: nft_collection_exists
  params:
    collection_id: "collection_hash"

expected:
  status: success
  result: true
  compute_units: 500

---
spec:
  name: syscall_nft_update_collection
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Update collection metadata (owner only)"
  priority: P1

preconditions:
  - caller:
      address: "tos1owner..."
      is_collection_owner: true
  - collection:
      id: "collection_hash"

action:
  type: syscall
  name: nft_update_collection
  params:
    collection_id: "collection_hash"
    new_metadata_uri: "ipfs://QmNewMetadata..."

expected:
  status: success
  compute_units: 2000

---
spec:
  name: syscall_nft_transfer_collection_ownership
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Transfer collection ownership to new owner"
  priority: P1

preconditions:
  - caller:
      address: "tos1currentowner..."
      is_collection_owner: true
  - collection:
      id: "collection_hash"

action:
  type: syscall
  name: nft_transfer_collection_ownership
  params:
    collection_id: "collection_hash"
    new_owner: "tos1newowner..."

expected:
  status: success
  compute_units: 2000

postconditions:
  - collection:
      owner: "tos1newowner..."

---
spec:
  name: syscall_nft_mint
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Mint a new NFT token"
  priority: P0

preconditions:
  - caller:
      address: "tos1minter..."
      has_mint_authority: true
  - collection:
      id: "collection_hash"
      current_supply: 5
      max_supply: 10000

action:
  type: syscall
  name: nft_mint
  params:
    collection_id: "collection_hash"
    to: "tos1recipient..."
    metadata_uri: "ipfs://QmToken123..."

expected:
  status: success
  compute_units: 2000  # + URI bytes
  result:
    token_id: 6

postconditions:
  - nft:
      collection: "collection_hash"
      token_id: 6
      owner: "tos1recipient..."
      uri: "ipfs://QmToken123..."
  - collection:
      current_supply: 6

---
spec:
  name: syscall_nft_batch_mint
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Mint multiple NFTs in one call"
  priority: P1

preconditions:
  - caller:
      has_mint_authority: true
  - collection:
      id: "collection_hash"
      current_supply: 0

action:
  type: syscall
  name: nft_batch_mint
  params:
    collection_id: "collection_hash"
    to: "tos1recipient..."
    count: 5
    base_uri: "ipfs://QmBatch/"

expected:
  status: success
  compute_units: 10000  # 2000 * 5
  result:
    first_token_id: 1
    last_token_id: 5

postconditions:
  - collection:
      current_supply: 5

---
spec:
  name: syscall_nft_burn
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Burn an NFT token"
  priority: P0

preconditions:
  - caller:
      address: "tos1owner..."
  - nft:
      collection: "collection_hash"
      token_id: 1
      owner: "tos1owner..."
  - collection:
      current_supply: 5

action:
  type: syscall
  name: nft_burn
  params:
    collection_id: "collection_hash"
    token_id: 1

expected:
  status: success
  compute_units: 2000

postconditions:
  - nft:
      collection: "collection_hash"
      token_id: 1
      exists: false
  - collection:
      current_supply: 4

---
spec:
  name: syscall_nft_batch_burn
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Burn multiple NFTs in one call"
  priority: P1

preconditions:
  - caller:
      address: "tos1owner..."
  - nfts_owned: [1, 2, 3]

action:
  type: syscall
  name: nft_batch_burn
  params:
    collection_id: "collection_hash"
    token_ids: [1, 2, 3]

expected:
  status: success
  compute_units: 6000  # 2000 * 3

---
spec:
  name: syscall_nft_transfer
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Transfer NFT to another address"
  priority: P0

preconditions:
  - caller:
      address: "tos1owner..."
  - nft:
      collection: "collection_hash"
      token_id: 1
      owner: "tos1owner..."

action:
  type: syscall
  name: nft_transfer
  params:
    collection_id: "collection_hash"
    token_id: 1
    from: "tos1owner..."
    to: "tos1recipient..."

expected:
  status: success
  compute_units: 2000

postconditions:
  - nft:
      token_id: 1
      owner: "tos1recipient..."

---
spec:
  name: syscall_nft_batch_transfer
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Transfer multiple NFTs in one call"
  priority: P1

preconditions:
  - caller:
      address: "tos1owner..."
  - nfts_owned: [1, 2, 3]

action:
  type: syscall
  name: nft_batch_transfer
  params:
    collection_id: "collection_hash"
    token_ids: [1, 2, 3]
    from: "tos1owner..."
    to: "tos1recipient..."

expected:
  status: success
  compute_units: 6000  # 2000 * 3

---
spec:
  name: syscall_nft_exists
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Check if NFT token exists"
  priority: P0

preconditions:
  - nft:
      collection: "collection_hash"
      token_id: 1
      exists: true

action:
  type: syscall
  name: nft_exists
  params:
    collection_id: "collection_hash"
    token_id: 1

expected:
  status: success
  result: true
  compute_units: 500

---
spec:
  name: syscall_nft_owner_of
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Get NFT owner address"
  priority: P0

preconditions:
  - nft:
      collection: "collection_hash"
      token_id: 1
      owner: "tos1owner..."

action:
  type: syscall
  name: nft_owner_of
  params:
    collection_id: "collection_hash"
    token_id: 1

expected:
  status: success
  result: "tos1owner..."
  compute_units: 500

---
spec:
  name: syscall_nft_balance_of
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Get NFT balance for address in collection"
  priority: P0

preconditions:
  - account:
      address: "tos1owner..."
      nft_count_in_collection: 5

action:
  type: syscall
  name: nft_balance_of
  params:
    collection_id: "collection_hash"
    owner: "tos1owner..."

expected:
  status: success
  result: 5
  compute_units: 500

---
spec:
  name: syscall_nft_token_uri
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Get NFT token URI"
  priority: P0

preconditions:
  - nft:
      collection: "collection_hash"
      token_id: 1
      uri: "ipfs://QmToken123..."

action:
  type: syscall
  name: nft_token_uri
  params:
    collection_id: "collection_hash"
    token_id: 1

expected:
  status: success
  result: "ipfs://QmToken123..."
  compute_units: 500

---
spec:
  name: syscall_nft_approve
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Approve address for single NFT transfer"
  priority: P0

preconditions:
  - caller:
      address: "tos1owner..."
  - nft:
      token_id: 1
      owner: "tos1owner..."

action:
  type: syscall
  name: nft_approve
  params:
    collection_id: "collection_hash"
    token_id: 1
    approved: "tos1operator..."

expected:
  status: success
  compute_units: 2000

postconditions:
  - nft:
      token_id: 1
      approved: "tos1operator..."

---
spec:
  name: syscall_nft_get_approved
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Get approved address for NFT"
  priority: P0

preconditions:
  - nft:
      token_id: 1
      approved: "tos1operator..."

action:
  type: syscall
  name: nft_get_approved
  params:
    collection_id: "collection_hash"
    token_id: 1

expected:
  status: success
  result: "tos1operator..."
  compute_units: 500

---
spec:
  name: syscall_nft_set_approval_for_all
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Set operator approval for all tokens"
  priority: P0

preconditions:
  - caller:
      address: "tos1owner..."

action:
  type: syscall
  name: nft_set_approval_for_all
  params:
    collection_id: "collection_hash"
    operator: "tos1operator..."
    approved: true

expected:
  status: success
  compute_units: 2000

postconditions:
  - approval:
      owner: "tos1owner..."
      operator: "tos1operator..."
      approved: true

---
spec:
  name: syscall_nft_is_approved_for_all
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Check operator approval status"
  priority: P0

preconditions:
  - approval:
      owner: "tos1owner..."
      operator: "tos1operator..."
      approved: true

action:
  type: syscall
  name: nft_is_approved_for_all
  params:
    collection_id: "collection_hash"
    owner: "tos1owner..."
    operator: "tos1operator..."

expected:
  status: success
  result: true
  compute_units: 500

---
spec:
  name: syscall_nft_set_minting_paused
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Pause or unpause minting (owner only)"
  priority: P1

preconditions:
  - caller:
      address: "tos1owner..."
      is_collection_owner: true
  - collection:
      minting_paused: false

action:
  type: syscall
  name: nft_set_minting_paused
  params:
    collection_id: "collection_hash"
    paused: true

expected:
  status: success
  compute_units: 2000

postconditions:
  - collection:
      minting_paused: true

---
spec:
  name: syscall_nft_update_attribute
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Update NFT attribute (metadata)"
  priority: P1

preconditions:
  - caller:
      has_update_authority: true
  - nft:
      token_id: 1

action:
  type: syscall
  name: nft_update_attribute
  params:
    collection_id: "collection_hash"
    token_id: 1
    key: "rarity"
    value: "legendary"

expected:
  status: success
  compute_units: 2000

postconditions:
  - nft:
      token_id: 1
      attributes:
        rarity: "legendary"

---
spec:
  name: syscall_nft_remove_attribute
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Remove NFT attribute"
  priority: P1

preconditions:
  - caller:
      has_update_authority: true
  - nft:
      token_id: 1
      attributes:
        rarity: "legendary"

action:
  type: syscall
  name: nft_remove_attribute
  params:
    collection_id: "collection_hash"
    token_id: 1
    key: "rarity"

expected:
  status: success
  compute_units: 2000

postconditions:
  - nft:
      token_id: 1
      attributes:
        rarity: null

---
spec:
  name: syscall_nft_transfer_not_owner
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Transfer by non-owner fails"
  priority: P0

preconditions:
  - caller:
      address: "tos1notowner..."
  - nft:
      token_id: 1
      owner: "tos1realowner..."
      approved: null

action:
  type: syscall
  name: nft_transfer
  params:
    collection_id: "collection_hash"
    token_id: 1
    from: "tos1realowner..."
    to: "tos1recipient..."

expected:
  status: error
  error: "NotOwnerOrApproved"
  note: "Only owner or approved address can transfer"

---
spec:
  name: syscall_nft_transfer_by_approved
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Transfer by approved address succeeds"
  priority: P0

preconditions:
  - caller:
      address: "tos1operator..."
  - nft:
      token_id: 1
      owner: "tos1owner..."
      approved: "tos1operator..."

action:
  type: syscall
  name: nft_transfer
  params:
    collection_id: "collection_hash"
    token_id: 1
    from: "tos1owner..."
    to: "tos1recipient..."

expected:
  status: success
  compute_units: 2000

postconditions:
  - nft:
      token_id: 1
      owner: "tos1recipient..."
      approved: null  # Approval cleared after transfer

---
spec:
  name: syscall_nft_mint_when_paused
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Minting fails when paused"
  priority: P1

preconditions:
  - collection:
      minting_paused: true
  - caller:
      has_mint_authority: true

action:
  type: syscall
  name: nft_mint
  params:
    collection_id: "collection_hash"
    to: "tos1recipient..."
    metadata_uri: "ipfs://..."

expected:
  status: error
  error: "MintingPaused"

---
spec:
  name: syscall_nft_mint_max_supply_reached
  version: "1.0"
  category: syscalls
  subcategory: nft
  description: "Minting fails when max supply reached"
  priority: P0

preconditions:
  - collection:
      max_supply: 100
      current_supply: 100

action:
  type: syscall
  name: nft_mint
  params:
    collection_id: "collection_hash"
    to: "tos1recipient..."
    metadata_uri: "ipfs://..."

expected:
  status: error
  error: "MaxSupplyReached"
